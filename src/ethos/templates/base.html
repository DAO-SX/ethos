<!-- Copy from SIWE Notepad project-->
<html>
    <head>
        <title>EthOS</title>
        <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://unpkg.com/98.css" />
        <script src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script>
        <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet" />
        <script src="{{ url_for('static', filename='js/bundle.js')}}"></script>
        <script src="{{ url_for('static', filename='js/utils.js')}}"></script>
        <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png')}}" />
        <link rel="stylesheet" href="{{ url_for('static', filename='node_modules/xterm/css/xterm.css')}}" />
        <script src="{{ url_for('static', filename='js/xterm.min.js')}}"></script>
        <script src="{{ url_for('static', filename='js/xterm-addon-attach.min.js')}}"></script>
        <script src="{{ url_for('static', filename='js/xterm-addon-fit.min.js')}}"></script>
        <script src="{{ url_for('static', filename='js/xterm-addon-unicode11.min.js')}}"></script>
        <meta
            http-equiv="Content-Security-Policy"
            content="default-src 'self'; script-src 'self' cdn-cors.ethers.io cdnjs.cloudflare.com 'unsafe-inline'; font-src 'self' unpkg.com; connect-src 'self' wss://echo.websocket.events ws://127.0.0.1:4001 wss://*.walletconnect.org https://*.walletconnect.org https://*.infura.io; img-src 'self' data:; style-src 'self' 'unsafe-inline' unpkg.com;"
        />
    </head>

    <body class="h-screen w-screen flex flex-col">
        <div class="w-full h-full" id="desktop">
            <div class="window inline-block select-none">
                <div class="title-bar">
                    <div class="title-bar-text">
                        <div class="flex">
                            <img src="{{ url_for('static', filename='img/favicon.png')}}" alt="Notepad icon" class="w-4 h-4 mr-1" />
                            <p id="title">Untitled</p>
                            &nbsp- Notepad&nbsp
                            <p id="unsaved"></p>
                        </div>
                    </div>
                    <div class="title-bar-controls">
                        <button id="closeButton" aria-label="Close" title="Sign-Out"></button>
                    </div>
                </div>
                <div class="flex py-0.5">
                    <div
                        id="disconnectButton"
                        class="cursor-default hover:bg-blue-900 hover:text-white px-1 hidden"
                    >
                        Disconnect
                    </div>
                    <div
                        id="saveButton"
                        class="cursor-default hover:bg-blue-900 hover:text-white px-1 hidden"
                    >
                        Save
                    </div>
                    <div
                        id="metamask"
                        class="cursor-default hover:bg-blue-900 hover:text-white px-1"
                    >
                        Metamask
                    </div>
                    <div
                        id="walletconnect"
                        class="cursor-default hover:bg-blue-900 hover:text-white px-1"
                    >
                        WalletConnect
                    </div>
                </div>
                <textarea
                    name="notepad"
                    id="notepad"
                    cols="30"
                    rows="10"
                    spellcheck="false"
                    class="mousetrap"
                ></textarea>
            </div>

            <div class="window inline-block">
                <div class="title-bar">
                  <div class="title-bar-text">EthOS</div>
                  <div class="title-bar-controls">
                    <button aria-label="Close"></button>
                  </div>
                </div>
                <div class="window-body">
                    <p id="terminal"></p>
                  </div>
              </div>
        </div>
        <div class="h-8 menu-bar flex justify-between">
            <a href="https://mytokenhq.slack.com/" target="_blank">
                <button class="m-1">
                    <div class="flex items-center justify-evenly">
                        <img
                            src="{{ url_for('static', filename='img/start-button.png') }}"
                            alt="Start Button"
                            class="w-3 h-4 mb-0.5"
                            draggable="false"
                        />
                        &nbsp&nbspJoin Our Slack Community
                    </div>
                </button>
            </a>
            <div
                id="clock"
                class="clock justify-end px-2 items-center flex m-1 cursor-default select-none"
            ></div>
        </div>
        <script>
            $(function() {
                var term = new Terminal({
                    convertEol: true,
                    disableStdin: true,
                    scrollback: 1024,
                    tabStopWidth: 4,
                    fontFamily: 'SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace, "Microsoft YaHei", SimSun',
                });

                const unicode11Addon = new Unicode11Addon.Unicode11Addon();
                term.loadAddon(unicode11Addon);
                term.unicode.activeVersion = '11';

                const fitAddon = new FitAddon.FitAddon();
                term.loadAddon(fitAddon);
                fitAddon.fit();

                term.open(document.getElementById('terminal'));
                term.write('\x1B[1;3;31mEthOS v0.1\x1B[0m ')

                // let ws = new WebSocket('wss://echo.websocket.events/.ws');
                let ws = new WebSocket('ws://127.0.0.1:4001/', 'ascii');
                const attachAddon = new AttachAddon.AttachAddon(ws);
                term.loadAddon(attachAddon);

                ws.onopen = function () {
                    term.write('Connected.\r\n\r\n');
                }
                ws.onerror = function (err) {
                    console.log(err);
                }
                ws.onclose = function () {
                    term.write('\r\nDisconnected.\r\n');
                }
            });
          </script>
    </body>
</html>
